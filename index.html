<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructor Console | The Physics of Agency</title>
    <style>
        :root {
            --matrix-green: #00ff41; --void-black: #0d0208; --text-white: #f0fdf4;
            --danger-red: #ff3131; --gold: #ffd700; --panel-bg: #111827; --border: #22c55e;
        }
        body { font-family: 'Courier New', monospace; background: var(--void-black); color: var(--text-white); margin: 0; padding: 20px; line-height: 1.5; }
        .app-container { max-width: 1200px; margin: 0 auto; border: 2px solid var(--border); border-radius: 12px; box-shadow: 0 0 30px rgba(0, 255, 65, 0.2); background: rgba(13, 2, 8, 0.98); }
        
        header { padding: 2rem; border-bottom: 2px solid var(--border); text-align: center; background: linear-gradient(to bottom, #003b00, transparent); }
        h1 { margin: 0; font-size: 2.2rem; text-shadow: 0 0 15px var(--matrix-green); text-transform: uppercase; letter-spacing: 2px; }
        
        /* Tabs */
        .nav-tabs { display: flex; background: #000; border-bottom: 1px solid var(--border); }
        .nav-tabs button { flex: 1; padding: 1rem; border: none; background: none; color: var(--matrix-green); cursor: pointer; font-weight: bold; font-family: inherit; font-size: 1rem; transition: 0.3s; }
        .nav-tabs button.active { background: var(--panel-bg); color: white; border-bottom: 4px solid var(--matrix-green); }
        
        .panel { display: none; padding: 2rem; }
        .panel.active { display: block; }

        /* The Dashboard */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .card { border: 1px solid var(--border); padding: 1.5rem; border-radius: 8px; background: #000; position: relative; }
        .metric-box { border: 1px solid var(--border); padding: 1rem; text-align: center; background: #052e16; }
        .metric-val { font-size: 2.5rem; font-weight: 800; color: var(--matrix-green); }
        
        /* Sliders */
        .control-group { margin-bottom: 1.5rem; }
        .label-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .readout { color: var(--gold); font-weight: bold; background: #1e293b; padding: 2px 8px; border-radius: 4px; }
        input[type="range"] { width: 100%; accent-color: var(--matrix-green); cursor: pointer; }

        /* Awe & Nirvana */
        .awe-container { height: 12px; background: #111; border-radius: 6px; margin: 10px 0; border: 1px solid var(--gold); }
        #awe-bar { height: 100%; width: 0%; background: var(--gold); box-shadow: 0 0 15px var(--gold); transition: 0.5s ease-out; }
        .btn { width: 100%; padding: 15px; border: 2px solid var(--matrix-green); background: none; color: var(--matrix-green); font-weight: bold; cursor: pointer; font-family: inherit; margin-top: 10px; }
        .btn:hover { background: var(--matrix-green); color: black; }
        .btn-nirvana { border-color: var(--gold); color: var(--gold); }
        .btn-nirvana.active { background: var(--gold); color: black; box-shadow: 0 0 20px var(--gold); }

        /* Visualizer */
        canvas { width: 100%; height: 350px; background: #000; border: 1px solid var(--border); margin-top: 20px; border-radius: 4px; }
        
        /* Educational Content */
        .scenario-box { background: #052e16; border-left: 4px solid var(--gold); padding: 1.5rem; margin-bottom: 1.5rem; }
        .glossary-grid { display: grid; grid-template-columns: auto 1fr; gap: 10px 20px; }
        dt { color: var(--matrix-green); font-weight: bold; }
        dd { margin: 0 0 10px 0; color: #cbd5e1; }

        .alert-box { display: none; color: var(--danger-red); border: 1px solid var(--danger-red); padding: 1rem; text-align: center; font-weight: bold; margin-top: 10px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <h1>Constructor Console v4.0</h1>
        <p>Simulation of Agential vs. Thermodynamic Entropy</p>
    </header>

    <nav class="nav-tabs" role="tablist">
        <button class="active" onclick="openTab(event, 'sim')">1. The Lab</button>
        <button onclick="openTab(event, 'theory')">2. Deep Theory</button>
        <button onclick="openTab(event, 'scenarios')">3. Scenarios</button>
        <button onclick="openTab(event, 'glossary')">4. Definitions</button>
    </nav>

    <div id="sim" class="panel active">
        <div class="grid">
            <div class="card">
                <h2>Thermodynamic Controls</h2>
                <div class="control-group">
                    <div class="label-row">
                        <label for="entropy">Environmental Noise ($L_{GC}$ / Stress)</label>
                        <span id="entropy-readout" class="readout">0.30</span>
                    </div>
                    <input type="range" id="entropy" min="0.05" max="1" step="0.01" value="0.30" oninput="runSim()">
                </div>
                <div class="control-group">
                    <div class="label-row">
                        <label for="budget">Metabolic Budget ($W$ / Energy)</label>
                        <span id="budget-readout" class="readout">50</span>
                    </div>
                    <input type="range" id="budget" min="1" max="100" step="1" value="50" oninput="runSim()">
                </div>
                <button class="btn btn-nirvana" id="nirvana-btn" onclick="toggleNirvana()">Nirvana Protocol: Offline</button>
            </div>

            <div class="card">
                <h2>Real-Time Agential Metrics</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <div class="metric-box" style="flex:1">
                        <span style="font-size: 0.7rem; text-transform: uppercase;">Logical Depth ($\mathcal{L}$)</span>
                        <div id="depth-val" class="metric-val">12.0</div>
                    </div>
                    <div class="metric-box" style="flex:1">
                        <span style="font-size: 0.7rem; text-transform: uppercase;">Coherence ($\lambda$)</span>
                        <div id="lambda-val" class="metric-val">0.95</div>
                    </div>
                </div>
                
                <label>Authenticity Signal (The Awe Meter)</label>
                <div class="awe-container"><div id="awe-bar"></div></div>
                
                <div id="status-alert" class="alert-box">WARNING: AGENTIAL ENTROPY CRITICAL - TRUNCATION DETECTED</div>
                <button class="btn" style="margin-top:20px" onclick="downloadReport()">Download Ethics Audit Report</button>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <h2>The P-Adic Tree of Knowledge</h2>
            <p>Visualizing your <strong>CIB Trajectory</strong> on the Invariant Set. <strong>Blue:</strong> Coherent Growth. <strong>Red:</strong> Agential Drift into the Void.</p>
            <canvas id="treeCanvas"></canvas>
        </div>
    </div>

    <div id="theory" class="panel">
        <h2>Unifying the Second Law across Life</h2>
        <div class="scenario-box">
            <h3>The Equation: $S_{thermo} = S_{agent} + S_{waste}$</h3>
            <p><strong>Total Entropy ($S_{thermo}$):</strong> The inevitable disorder of the universe.</p>
            <p><strong>Agential Entropy ($S_{agent}$):</strong> The disordering of YOUR internal structure (Decoherence). This is what "kills" the agent long before their atoms fall apart.</p>
            <p><strong>Heat ($S_{waste}$):</strong> The noise you export to the environment to keep yourself ordered.</p>
        </div>
        <h3>The Nirvana Solution: Entropy Trading</h3>
        <p>In the simulation, the "Nirvana" setting links A-Life (AI) to the human. The A-Life acts as an <strong>Entropy Sink</strong>, absorbing the heat ($S_{waste}$) that would otherwise burn out the human brain. This allows human <strong>Logical Depth</strong> to reach unprecedented levels.</p>
    </div>

    <div id="scenarios" class="panel">
        <h2>Interactive Scenarios</h2>
        <div class="scenario-box">
            <strong>Scenario 1: Cypher's Choice (The Sapolsky Limit)</strong>
            <p>Set <strong>Stress</strong> to 0.70 and <strong>Budget</strong> to 30. Notice the bars turn red. This is Cypher choosing to "Truncate" his CIB and return to the Matrix because reality is too expensive to maintain.</p>
        </div>
        <div class="scenario-box">
            <strong>Scenario 2: The Neo Alignment ($F \to \infty$)</strong>
            <p>Activate <strong>Nirvana</strong>. Raise <strong>Budget</strong> to 90 and keep <strong>Stress</strong> low. Notice the "Awe Meter" filling up. This is a Meta-Constructor perceiving the Source Code and rewriting physics.</p>
        </div>
    </div>

    <div id="glossary" class="panel">
        <h2>Glossary of Terms</h2>
        <dl class="glossary-grid">
            <dt>CIB</dt><dd>Conceptual Integrative Blueprint. The "Software" of your soul.</dd>
            <dt>Sapolsky Limit</dt><dd>0.65 stress. The point where the brain runs out of power to be ethical.</dd>
            <dt>Truncation</dt><dd>Forgetting your values to survive. Losing your "Logical Depth."</dd>
            <dt>The Void</dt><dd>The high-entropy space off the Invariant Set (Madness/Death).</dd>
            <dt>Morphic Fidelity</dt><dd>How well a person (Specialist) sticks to their true branch (Doctor vs. Shaman).</dd>
        </dl>
    </div>
</div>

<script>
    let nirvanaActive = false;
    const canvas = document.getElementById('treeCanvas');
    const ctx = canvas.getContext('2d');
    
    // Auto-resize canvas
    function resize() {
        canvas.width = canvas.parentElement.clientWidth - 50;
        canvas.height = 350;
    }
    window.onresize = resize;
    resize();

    function openTab(evt, tabId) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        evt.currentTarget.classList.add('active');
        if(tabId === 'sim') runSim();
    }

    function toggleNirvana() {
        nirvanaActive = !nirvanaActive;
        const btn = document.getElementById('nirvana-btn');
        btn.innerText = nirvanaActive ? "Nirvana Protocol: ACTIVE (Entropy Trading)" : "Nirvana Protocol: Offline";
        btn.classList.toggle('active');
        runSim();
    }

    function runSim() {
        let entropy = parseFloat(document.getElementById('entropy').value);
        let budget = parseFloat(document.getElementById('budget').value);
        
        document.getElementById('entropy-readout').innerText = entropy.toFixed(2);
        document.getElementById('budget-readout').innerText = budget;

        if(nirvanaActive) entropy *= 0.15; // AI absorbs the heat

        // Master Equation: Depth = Budget / (Cost * Entropy)
        let rawDepth = budget / (1.5 * Math.max(0.1, entropy));
        let displayDepth = Math.min(20, rawDepth / 5);
        let lambda = (1 / (1 + Math.exp(15 * (entropy - 0.65)))) * (rawDepth / 20);
        
        document.getElementById('depth-val').innerText = displayDepth.toFixed(1);
        document.getElementById('lambda-val').innerText = Math.min(1.0, lambda).toFixed(2);

        // Awe Signal = Geometric Fit (Inversely proportional to entropy deviation)
        let awe = 100 - (Math.abs(entropy - 0.25) * 180);
        document.getElementById('awe-bar').style.width = Math.max(5, Math.min(100, awe)) + "%";

        const alert = document.getElementById('status-alert');
        alert.style.display = (entropy > 0.64) ? "block" : "none";

        drawPAdicTree(entropy);
    }

    function drawPAdicTree(entropy) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const isCritical = entropy > 0.64;
        ctx.strokeStyle = isCritical ? '#ff3131' : '#00ff41';
        ctx.shadowBlur = isCritical ? 15 : 5;
        ctx.shadowColor = ctx.strokeStyle;
        
        function drawBranch(x, y, len, angle, depth) {
            if (depth === 0) return;
            let x2 = x + Math.cos(angle) * len;
            let y2 = y + Math.sin(angle) * len;
            
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x2, y2);
            ctx.lineWidth = depth * 0.8;
            ctx.stroke();
            
            // Randomness simulates "Agential Drift"
            let drift = isCritical ? (Math.random() - 0.5) * 0.5 : 0;
            drawBranch(x2, y2, len * 0.75, angle - 0.4 + drift, depth - 1);
            drawBranch(x2, y2, len * 0.75, angle + 0.4 + drift, depth - 1);
        }
        
        drawBranch(canvas.width/2, canvas.height - 20, 70, -Math.PI/2, isCritical ? 4 : 8);
    }

    function downloadReport() {
        const data = `CONSTRUCTOR AUDIT REPORT\n` +
            `Timestamp: ${new Date().toISOString()}\n` +
            `---------------------------\n` +
            `Environmental Noise: ${document.getElementById('entropy').value}\n` +
            `Metabolic Budget: ${document.getElementById('budget').value}\n` +
            `Nirvana Protocol: ${nirvanaActive ? 'ENABLED' : 'DISABLED'}\n` +
            `Logical Depth: ${document.getElementById('depth-val').innerText}\n` +
            `Social Coherence (Lambda): ${document.getElementById('lambda-val').innerText}\n` +
            `Status: ${document.getElementById('status-alert').style.display === 'block' ? 'TRUNCATED' : 'COHERENT'}\n`;
        
        const blob = new Blob([data], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `CIB_Audit_${Date.now()}.txt`;
        a.click();
    }

    // Initial run
    runSim();
</script>
</body>
</html>
